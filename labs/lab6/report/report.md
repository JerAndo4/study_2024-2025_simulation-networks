---
## Front matter
title: "Моделирование сетей передачи данных"
subtitle: "Отчёт по лабораторной работе №6: Настройка пропускной способности глобальной сети с помощью Token Bucket Filter"
author: "Кармацкий Никита Сергеевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---
# Цель работы

Основной целью работы является знакомство с принципами работы дисциплины очереди Token Bucket Filter, которая формирует входящий/исходящий трафик для ограничения пропускной способности, а также получение навыков моделирования и исследования поведения трафика посредством проведения интерактивного и воспроизводимого экспериментов в Mininet.

# Выполнение лабораторной работы

1. В виртуальной машине mininet исправим права запуска X-соединения  (рис. [-@fig:001]):

![Исправление прав запуска X-соединения в виртуальной машине mininet](image/1.PNG){ #fig:001 width=100% height=100% }

2. Зададим простейшую топологию, состоящую из двух хостов и двух коммутаторов с назначенной по умолчанию mininet сетью 10.0.0.0/8  (рис. [-@fig:002]):

![Создание простейшей топологии с двумя коммутаторами и двумя хостами](image/2.PNG){ #fig:002 width=100% height=100% }

3. На хостах h1, h2 и на коммутаторах s1, s2 введём команду ifconfig, чтобы отобразить информацию, относящуюся к их сетевым интерфейсам и назначенным им IP-адресам. В дальнейшем при работе с NETEM и командой tc будем использовать интерфейсы h1-eth0, h2-eth0, s1-eth2 (рис. [-@fig:003]):

![Отображение информации их сетевых интерфейсов и IP-адресов](image/3.PNG){ #fig:003 width=100% height=100% }

4. Проверим подключение между хостами h1 и h2 с помощью команды ping с параметром -c 4(рис. [-@fig:004]):

![Проверка подключения между хостами](image/4.PNG){ #fig:004 width=100% height=100% }

5. В терминале хоста h2 запустим iPerf3 в режиме сервера (рис. [-@fig:005]):

![Запуск iPerf3 в режиме сервера на хосте h2](image/5.PNG){ #fig:005 width=100% height=100% }

6. В терминале хоста h1 запустим iPerf3 в режиме клиента  (рис. [-@fig:006]):

![Запуск iPerf3 в режиме клиента на хосте h1](image/6.PNG){ #fig:006 width=100% height=100% }

7. После завершения работы iPerf3 на хосте h1 остановим iPerf3 на хосте h2, нажав Ctrl + c (рис. [-@fig:007])

![Остановка iPerf3](image/7.PNG){ #fig:007 width=100% height=100% }

8. Команду tc можно применить к сетевому интерфейсу устройства для формирования исходящего трафика. Требуется ограничить скорость отправки данных с конечного хоста с помощью фильтра Token Bucket Filter (tbf).

Изменим пропускную способность хоста h1, установив пропускную способность на 10 Гбит/с на интерфейсе h1-eth0 и параметры TBF-фильтра (рис. [-@fig:008]):

![Изменение пропускной способности хоста h1](image/8.PNG){ #fig:008 width=100% height=100% }

9.  Фильтр tbf требует установки значения всплеска при ограничении скорости. Это значение должно быть достаточно высоким, чтобы обеспечить установленную скорость. Она должна быть не ниже указанной частоты, делённой на HZ, где HZ — тактовая частота, настроенная как параметр ядра, и может быть извлечена с помощью следующей команды(рис. [-@fig:009]):

![Установка значения всплеска при ограничении скорости для фильтра tbf](image/9.PNG){ #fig:009 width=100% height=100% }

10. В терминале хоста h2 запустим iPerf3 в режиме сервера (рис. [-@fig:010]):

![Запуск iPerf3 в режиме сервера на хосте h2](image/10.PNG){ #fig:010 width=100% height=100% }

11. В терминале хоста h1 запустим iPerf3 в режиме клиента (рис. [-@fig:011]):

![Запуск iPerf3 в режиме клиента на хосте h1](image/11.PNG){ #fig:011 width=100% height=100% }

12. После завершения работы iPerf3 на хосте h1 остановим iPerf3 на хосте h2, нажав Ctrl + c  (рис. [-@fig:012]):

![Остановка iPerf3](image/12.PNG){ #fig:012 width=100% height=100% }

13. Удалим модифицированную конфигурацию на хосте h1 (рис. [-@fig:013]):

![Восстановление конфигурацию по умолчанию](image/13.PNG){ #fig:013 width=100% height=100% }

14. Применим правило ограничения скорости tbf с параметрами rate = 10gbit, burst = 5,000,000, limit= 15,000,000 к интерфейсу s1-eth2 коммутатора s1, который соединяет его с коммутатором s2(рис. [-@fig:014]):

![Применение правила ограничения скорости tbf](image/14.PNG){ #fig:014 width=100% height=100% }

15. В терминале хоста h2 запустим iPerf3 в режиме сервера  (рис. [-@fig:015]):

![Запуск iPerf3 в режиме сервера на хосте h2](image/15.PNG){ #fig:015 width=100% height=100% }

16. В терминале хоста h1 запустим iPerf3 в режиме клиента(рис. [-@fig:016]):

![Запуск iPerf3 в режиме клиента на хосте h1](image/16.PNG){ #fig:016 width=100% height=100% }

17. После завершения работы iPerf3 на хосте h1 остановим iPerf3 на хосте h2, нажав Ctrl + c (рис. [-@fig:017]):

![Остановка iPerf3](image/17.PNG){ #fig:017 width=100% height=100% }

18. Удалим модифицированную конфигурацию на коммутаторе s1 (рис. [-@fig:018]):

![Восстановление конфигурацию по умолчанию на коммутаторе s1](image/18.PNG){ #fig:018 width=100% height=100% }

19. Объединим NETEM и TBF, введя на интерфейсе s1-eth2 коммутатора s1 задержку, джиттер, повреждение пакетов и указав скорость (рис. [-@fig:019]):

![Объединение NETEM и TBF](image/19.PNG){ #fig:019 width=100% height=100% }

20. Убедимся, что соединение от хоста h1 к хосту h2 имеет заданную задержку. Для этого запустим команду ping с параметром -c 4 с терминала хоста h1(рис. [-@fig:020]):

![Проверка задержки](image/20.PNG){ #fig:020 width=100% height=100% }

21. Добавим второе правило на коммутаторе s1, которое задаёт ограничение скорости с помощью tbf с параметрами rate=2gbit, burst=1,000,000, limit=2,000,000  (рис. [-@fig:021]):

![Добавление второго правила на коммутаторе s1](image/21.PNG){ #fig:021 width=100% height=100% }

22. В терминале хоста h2 запустим iPerf3 в режиме сервера (рис. [-@fig:022]):

![Запуск iPerf3 в режиме сервера на хосте h2](image/22.PNG){ #fig:022 width=100% height=100% }

23. В терминале хоста h1 запустим iPerf3 в режиме клиента (рис. [-@fig:023]):

![Запуск iPerf3 в режиме клиента на хосте h1](image/23.PNG){ #fig:023 width=100% height=100% }

24. После завершения работы iPerf3 на хосте h1 остановим iPerf3 на хосте h2, нажав Ctrl + c (рис. [-@fig:024]):

![Остановка iPerf3](image/24.PNG){ #fig:024 width=100% height=100% }

25. Удалим модифицированную конфигурацию на коммутаторе s1(рис. [-@fig:025]):

![Удаление модифицированной конфигурации на коммутаторе s1](image/25.PNG){ #fig:025 width=100% height=100% }

26. Для самостоятельного задания создадим необходимые каталоги (рис. [-@fig:026]):

![Создание необходимых каталогов](image/26.PNG){ #fig:026 width=100% height=100% }

27. Затем напишем скрипты по примеру из прошлых лабораторных работ  (рис. [-@fig:027] - рис. [-@fig:029]):

![Создание скрипта 1](image/27.PNG){ #fig:027 width=100% height=100% }

![Создание скрипта 2](image/28.PNG){ #fig:028 width=100% height=100% }

![Создание скрипта 3](image/29.PNG){ #fig:029 width=100% height=100% }

28. Запустим на выполнение скрипты для первой части самостоятельного задания (рис. [-@fig:030]):

![Выполнение скриптов](image/30.PNG){ #fig:030 width=100% height=100% }

29. Изменим параметры в скрипте для первого задания и запустим на выполнение (рис. [-@fig:031] - рис. [-@fig:032]):


![Изменение параметров](image/31.PNG){ #fig:031 width=100% height=100% }

![Выполнение скриптов](image/32.PNG){ #fig:032 width=100% height=100% }

30. Просмотрим полученные графики (рис. [-@fig:033] - рис. [-@fig:034]):

![График 1](image/33.PNG){ #fig:033 width=100% height=100% }

![График 2](image/34.PNG){ #fig:034 width=100% height=100% }


# Вывод

В ходе выполнения лабораторной работы познакомились с принципами работы дисциплины очереди Token Bucket Filter, которая формирует входящий/исходящий трафик для ограничения пропускной способности, а также получили навыки моделирования и исследования поведения трафика посредством проведения интерактивного и воспроизводимого экспериментов в Mininet.

# Список литературы. Библиография

[1] Mininet: https://mininet.org/